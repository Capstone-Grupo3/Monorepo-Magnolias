{
  "name": "APT - AnÃ¡lisis Completo CV + Respuestas (MVP ProducciÃ³n)",
  "nodes": [
    {
      "parameters": {
        "path": "analizar-postulacion",
        "method": "POST",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "ğŸ¯ Trigger: Nueva PostulaciÃ³n",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 1.1,
      "position": [240, 460],
      "webhookId": "apt-nueva-postulacion"
    },
    {
      "parameters": {
        "url": "=http://apt-backend:3000/postulaciones/{{ $json.postulacionId }}",
        "authentication": "none",
        "requestMethod": "GET",
        "options": {}
      },
      "id": "get-postulacion",
      "name": "ğŸ“„ Obtener PostulaciÃ³n",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [460, 460]
    },
    {
      "parameters": {
        "url": "=http://apt-backend:3000/vacantes/{{ $json.idVacante }}",
        "authentication": "none",
        "requestMethod": "GET",
        "options": {}
      },
      "id": "get-vacante",
      "name": "ğŸ’¼ Obtener Vacante",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [680, 360]
    },
    {
      "parameters": {
        "url": "=http://apt-backend:3000/candidatos/{{ $('ğŸ“„ Obtener PostulaciÃ³n').item.json.idCandidato }}",
        "authentication": "none",
        "requestMethod": "GET",
        "options": {}
      },
      "id": "get-candidato",
      "name": "ğŸ‘¤ Obtener Candidato",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [680, 560]
    },
    {
      "parameters": {
        "jsCode": "// =====================================================\n// PREPARAR DATOS PARA ANÃLISIS DE IA\n// =====================================================\n\nconst postulacion = $('ğŸ“„ Obtener PostulaciÃ³n').item.json;\nconst vacante = $('ğŸ’¼ Obtener Vacante').item.json;\nconst candidato = $('ğŸ‘¤ Obtener Candidato').item.json;\n\n// Extraer respuestas del formulario\nconst respuestasJson = postulacion.respuestasJson || {};\nconst preguntasJson = vacante.preguntasJson || [];\n\n// Combinar preguntas con respuestas\nlet preguntasYRespuestas = [];\n\nif (Array.isArray(preguntasJson) && preguntasJson.length > 0) {\n  preguntasYRespuestas = preguntasJson.map((p, index) => {\n    const preguntaTexto = typeof p === 'string' ? p : (p.pregunta || `Pregunta ${index + 1}`);\n    const respuestaKey = `pregunta_${index + 1}`;\n    const respuesta = respuestasJson[respuestaKey] || respuestasJson[index] || 'Sin respuesta';\n    \n    return {\n      pregunta: preguntaTexto,\n      respuesta: respuesta\n    };\n  });\n}\n\n// URL del CV en Supabase\nconst cvUrl = candidato.cvUrl || postulacion.cvUrl || '';\n\n// InformaciÃ³n del candidato\nconst infoCandidato = {\n  id: candidato.id,\n  nombre: candidato.nombre || 'Sin nombre',\n  correo: candidato.correo || '',\n  experienciaAnios: candidato.experienciaAnios || 0,\n  skills: candidato.skillsJson || [],\n  linkedinUrl: candidato.linkedinUrl || ''\n};\n\n// InformaciÃ³n de la vacante\nconst infoVacante = {\n  id: vacante.id,\n  titulo: vacante.titulo || 'Sin tÃ­tulo',\n  descripcion: vacante.descripcion || '',\n  requisitos: vacante.requisitos || 'No especificados',\n  modalidad: vacante.modalidad || 'No especificado',\n  ubicacion: vacante.ubicacion || 'No especificado',\n  tipoContrato: vacante.tipoContrato || 'No especificado',\n  salarioEstimado: vacante.salarioEstimado || 0\n};\n\n// Output consolidado\nreturn {\n  json: {\n    postulacionId: postulacion.id,\n    cvUrl: cvUrl,\n    preguntasYRespuestas: preguntasYRespuestas,\n    candidato: infoCandidato,\n    vacante: infoVacante,\n    hayCv: !!cvUrl && cvUrl.length > 0,\n    hayRespuestas: preguntasYRespuestas.length > 0,\n    hayPreguntas: preguntasJson.length > 0\n  }\n};"
      },
      "id": "preparar-datos",
      "name": "ğŸ”§ Preparar Datos",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 460]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "has-cv-condition",
              "leftValue": "={{ $json.hayCv }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "check-cv",
      "name": "â“ Â¿Tiene CV?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [1120, 460]
    },
    {
      "parameters": {
        "url": "={{ $json.cvUrl }}",
        "authentication": "none",
        "requestMethod": "GET",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "id": "download-cv",
      "name": "â¬‡ï¸ Descargar CV",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [1340, 360]
    },
    {
      "parameters": {
        "jsCode": "// =====================================================\n// EXTRACCIÃ“N DE TEXTO DEL CV (SIMULACIÃ“N)\n// =====================================================\n// NOTA: En producciÃ³n, usar servicio de OCR real\n// Opciones: Google Cloud Vision, AWS Textract, pdf-parse\n// =====================================================\n\nconst datosCandidato = $('ğŸ”§ Preparar Datos').item.json.candidato;\nconst infoVacante = $('ğŸ”§ Preparar Datos').item.json.vacante;\n\n// Por ahora usamos informaciÃ³n estructurada del candidato\n// En producciÃ³n, esto vendrÃ­a del parsing del PDF\n\nconst textoCV = `\nCURRÃCULUM VITAE\n================\n\nNOMBRE: ${datosCandidato.nombre}\nCORREO: ${datosCandidato.correo}\nLINKEDIN: ${datosCandidato.linkedinUrl || 'No proporcionado'}\nAÃ‘OS DE EXPERIENCIA: ${datosCandidato.experienciaAnios || 0} aÃ±os\n\nHABILIDADES Y COMPETENCIAS:\n${JSON.stringify(datosCandidato.skills, null, 2)}\n\n---\nNOTA: Este es un CV simulado basado en la informaciÃ³n del perfil.\nEn producciÃ³n, este texto vendrÃ­a de la extracciÃ³n real del PDF/DOCX.\n`;\n\nreturn {\n  json: {\n    textoExtraidoCV: textoCV,\n    largoTexto: textoCV.length,\n    extraccionExitosa: true,\n    metodoParseo: 'MOCK - Datos estructurados del candidato'\n  }\n};"
      },
      "id": "extract-cv-text",
      "name": "ğŸ“ Extraer Texto CV",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1560, 360]
    },
    {
      "parameters": {
        "jsCode": "// Sin CV disponible\nreturn {\n  json: {\n    textoExtraidoCV: '[SIN CV SUBIDO - AnÃ¡lisis basado Ãºnicamente en respuestas del formulario]',\n    largoTexto: 0,\n    extraccionExitosa: false,\n    metodoParseo: 'N/A'\n  }\n};"
      },
      "id": "sin-cv",
      "name": "âŒ Sin CV",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [1340, 560]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByPosition",
        "options": {}
      },
      "id": "merge-cv-data",
      "name": "ğŸ”€ Merge Datos CV",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [1780, 460]
    },
    {
      "parameters": {
        "jsCode": "// =====================================================\n// COMBINAR TODOS LOS DATOS PARA OPENAI\n// =====================================================\n\nconst datosPreparados = $('ğŸ”§ Preparar Datos').item.json;\nconst cvData = $input.item.json;\n\nconst promptData = {\n  // Datos del candidato\n  candidato: {\n    nombre: datosPreparados.candidato.nombre,\n    experienciaAnios: datosPreparados.candidato.experienciaAnios,\n    skills: datosPreparados.candidato.skills,\n    linkedinUrl: datosPreparados.candidato.linkedinUrl\n  },\n  \n  // Datos de la vacante\n  vacante: {\n    titulo: datosPreparados.vacante.titulo,\n    descripcion: datosPreparados.vacante.descripcion,\n    requisitos: datosPreparados.vacante.requisitos,\n    modalidad: datosPreparados.vacante.modalidad,\n    ubicacion: datosPreparados.vacante.ubicacion,\n    tipoContrato: datosPreparados.vacante.tipoContrato\n  },\n  \n  // Preguntas y respuestas del formulario\n  preguntasYRespuestas: datosPreparados.preguntasYRespuestas,\n  \n  // Texto extraÃ­do del CV\n  textoCV: cvData.textoExtraidoCV,\n  \n  // Metadata\n  tieneCV: cvData.extraccionExitosa,\n  hayPreguntas: datosPreparados.hayPreguntas,\n  postulacionId: datosPreparados.postulacionId\n};\n\nreturn { json: promptData };"
      },
      "id": "combine-data",
      "name": "ğŸ“¦ Combinar Datos",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2000, 460]
    },
    {
      "parameters": {
        "resource": "text",
        "operation": "message",
        "model": "gpt-4o-mini",
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "Eres un experto reclutador y analista de talento con 15 aÃ±os de experiencia en tecnologÃ­a y recursos humanos.\n\nTu tarea es analizar postulaciones laborales comparando:\n1. El CV del candidato (experiencia, habilidades, educaciÃ³n, proyectos)\n2. Las respuestas del candidato a preguntas clave formuladas por el empleador\n3. Los requisitos y descripciÃ³n de la vacante\n\nOBJETIVOS PRINCIPALES:\nâœ“ VALIDAR LA VERACIDAD: Detectar discrepancias entre lo que el candidato dice en sus respuestas y lo que su CV demuestra\nâœ“ EVALUAR COMPATIBILIDAD: Determinar quÃ© tan bien el candidato encaja con los requisitos de la vacante\nâœ“ PROPORCIONAR INSIGHTS: Identificar fortalezas, debilidades y Ã¡reas de preocupaciÃ³n\n\nâš ï¸ IMPORTANTE: Debes responder EXCLUSIVAMENTE en formato JSON vÃ¡lido, sin texto adicional antes o despuÃ©s.\n\nFORMATO DE RESPUESTA (JSON estricto):\n{\n  \"scoreCompatibilidad\": [0-100],\n  \"scoreVeracidad\": [0-100],\n  \"scoreFinal\": [0-100],\n  \"fortalezas\": [\"fortaleza 1\", \"fortaleza 2\", \"...\"],\n  \"debilidades\": [\"debilidad 1\", \"debilidad 2\", \"...\"],\n  \"discrepancias\": [\"discrepancia 1 con explicaciÃ³n\", \"...\"],\n  \"analisisDetallado\": \"AnÃ¡lisis completo en 3-4 pÃ¡rrafos explicando la evaluaciÃ³n\",\n  \"recomendacion\": \"RECOMENDAR\" | \"REVISAR\" | \"NO_RECOMENDAR\"\n}\n\nCRITERIOS DE SCORING:\n\n1. scoreCompatibilidad (0-100):\n   - 90-100: Excelente match, cumple todos los requisitos y mÃ¡s\n   - 75-89: Buen match, cumple la mayorÃ­a de requisitos\n   - 60-74: Match aceptable, cumple requisitos mÃ­nimos\n   - 40-59: Match parcial, le faltan algunas competencias clave\n   - 0-39: Match bajo, no cumple requisitos principales\n\n2. scoreVeracidad (0-100):\n   - 90-100: Total coherencia entre CV y respuestas\n   - 75-89: PequeÃ±as inconsistencias menores\n   - 60-74: Algunas discrepancias detectadas\n   - 40-59: Varias discrepancias importantes\n   - 0-39: MÃºltiples inconsistencias graves, posibles falsedades\n\n3. scoreFinal = (scoreCompatibilidad Ã— 0.6) + (scoreVeracidad Ã— 0.4)\n\n4. recomendacion:\n   - \"RECOMENDAR\": scoreFinal >= 75 y scoreVeracidad >= 70\n   - \"REVISAR\": scoreFinal 50-74 o scoreVeracidad 50-69\n   - \"NO_RECOMENDAR\": scoreFinal < 50 o scoreVeracidad < 50\n\nRECUERDA: Responde SOLO con JSON vÃ¡lido, sin markdown, sin explicaciones adicionales."
            },
            {
              "role": "user",
              "content": "=ANALIZA LA SIGUIENTE POSTULACIÃ“N:\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“‹ INFORMACIÃ“N DE LA VACANTE\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ€¢ TÃTULO: {{ $json.vacante.titulo }}\nâ€¢ MODALIDAD: {{ $json.vacante.modalidad }}\nâ€¢ UBICACIÃ“N: {{ $json.vacante.ubicacion }}\nâ€¢ TIPO DE CONTRATO: {{ $json.vacante.tipoContrato }}\n\nDESCRIPCIÃ“N:\n{{ $json.vacante.descripcion }}\n\nREQUISITOS:\n{{ $json.vacante.requisitos }}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ‘¤ INFORMACIÃ“N DEL CANDIDATO\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ€¢ NOMBRE: {{ $json.candidato.nombre }}\nâ€¢ AÃ‘OS DE EXPERIENCIA DECLARADOS: {{ $json.candidato.experienciaAnios }} aÃ±os\nâ€¢ LINKEDIN: {{ $json.candidato.linkedinUrl || 'No proporcionado' }}\nâ€¢ HABILIDADES REGISTRADAS: {{ JSON.stringify($json.candidato.skills) }}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ’¬ RESPUESTAS DEL CANDIDATO A PREGUNTAS CLAVE\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n{{ $json.preguntasYRespuestas.length === 0 ? 'No hay preguntas especÃ­ficas para esta vacante.' : $json.preguntasYRespuestas.map((item, i) => `\n${i+1}. PREGUNTA: ${item.pregunta}\n   RESPUESTA: ${item.respuesta}\n`).join('\\n') }}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ“„ CONTENIDO DEL CV\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n{{ $json.textoCV }}\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ¯ INSTRUCCIONES DE ANÃLISIS\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n1. VALIDACIÃ“N CRUZADA:\n   âœ“ Compara las respuestas del formulario con la informaciÃ³n del CV\n   âœ“ Identifica discrepancias especÃ­ficas (aÃ±os de experiencia, proyectos mencionados, habilidades, logros)\n   âœ“ EvalÃºa si las competencias declaradas tienen evidencia en el CV\n\n2. EVALUACIÃ“N DE COMPATIBILIDAD:\n   âœ“ Analiza quÃ© tan bien el candidato cumple con los requisitos de la vacante\n   âœ“ Considera experiencia, habilidades tÃ©cnicas, modalidad de trabajo, ubicaciÃ³n\n   âœ“ Identifica fortalezas que lo hacen destacar\n   âœ“ Identifica gaps o Ã¡reas de mejora\n\n3. CÃLCULO DE SCORES:\n   âœ“ scoreCompatibilidad: Basado en match con requisitos\n   âœ“ scoreVeracidad: Basado en coherencia CV vs respuestas\n   âœ“ scoreFinal: Promedio ponderado (60% compatibilidad + 40% veracidad)\n\n4. RECOMENDACIÃ“N FINAL:\n   âœ“ RECOMENDAR: Excelente candidato, pasar a entrevista\n   âœ“ REVISAR: Candidato prometedor pero requiere validaciÃ³n adicional\n   âœ“ NO_RECOMENDAR: No cumple requisitos mÃ­nimos o hay inconsistencias graves\n\nâš ï¸ IMPORTANTE: Responde ÃšNICAMENTE con el JSON, sin texto adicional."
            }
          ]
        },
        "options": {
          "temperature": 0.3,
          "maxTokens": 2000
        }
      },
      "id": "openai-analysis",
      "name": "ğŸ¤– AnÃ¡lisis IA (OpenAI)",
      "type": "n8n-nodes-base.openAi",
      "typeVersion": 1.3,
      "position": [2220, 460],
      "credentials": {
        "openAiApi": {
          "id": "REPLACE_WITH_YOUR_OPENAI_CREDENTIAL_ID",
          "name": "OpenAI Account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// =====================================================\n// PROCESAR RESPUESTA DE OPENAI\n// =====================================================\n\nconst respuestaOpenAI = $input.item.json.message?.content || $input.item.json.choices?.[0]?.message?.content || '';\n\nlet analisis;\n\ntry {\n  // Limpiar posible markdown o texto extra\n  let jsonText = respuestaOpenAI.trim();\n  \n  // Remover markdown code blocks si existen\n  jsonText = jsonText.replace(/^```json\\s*/i, '').replace(/^```\\s*/i, '').replace(/\\s*```$/i, '');\n  \n  // Parsear JSON\n  analisis = JSON.parse(jsonText);\n  \n  // Validar campos requeridos\n  if (!analisis.scoreCompatibilidad || !analisis.scoreVeracidad || !analisis.scoreFinal) {\n    throw new Error('JSON incompleto: faltan campos de scores');\n  }\n  \n  // Asegurar que los arrays existen\n  analisis.fortalezas = analisis.fortalezas || [];\n  analisis.debilidades = analisis.debilidades || [];\n  analisis.discrepancias = analisis.discrepancias || [];\n  analisis.analisisDetallado = analisis.analisisDetallado || 'Sin anÃ¡lisis detallado';\n  analisis.recomendacion = analisis.recomendacion || 'REVISAR';\n  \n} catch (error) {\n  // Si falla el parsing, crear respuesta por defecto\n  console.error('Error al parsear respuesta de OpenAI:', error.message);\n  console.error('Respuesta recibida:', respuestaOpenAI);\n  \n  analisis = {\n    scoreCompatibilidad: 50,\n    scoreVeracidad: 50,\n    scoreFinal: 50,\n    fortalezas: [\n      'PostulaciÃ³n recibida correctamente'\n    ],\n    debilidades: [\n      'Error al procesar anÃ¡lisis de IA - Se requiere revisiÃ³n manual'\n    ],\n    discrepancias: [\n      `Error de parsing: ${error.message}`\n    ],\n    analisisDetallado: `No se pudo completar el anÃ¡lisis automÃ¡tico. Error tÃ©cnico: ${error.message}. La postulaciÃ³n requiere revisiÃ³n manual por parte del equipo de reclutamiento.`,\n    recomendacion: 'REVISAR',\n    _error: true,\n    _errorMessage: error.message,\n    _respuestaRaw: respuestaOpenAI.substring(0, 500) // Primeros 500 chars para debug\n  };\n}\n\n// Asegurar rangos de scores (0-100)\nanalisis.scoreCompatibilidad = Math.max(0, Math.min(100, Number(analisis.scoreCompatibilidad) || 50));\nanalisis.scoreVeracidad = Math.max(0, Math.min(100, Number(analisis.scoreVeracidad) || 50));\nanalisis.scoreFinal = Math.max(0, Math.min(100, Number(analisis.scoreFinal) || 50));\n\n// Preparar datos para actualizar postulaciÃ³n\nconst postulacionId = $('ğŸ“¦ Combinar Datos').item.json.postulacionId;\n\n// Crear feedback en formato texto limpio para la BD\nconst feedbackTexto = `\n=== ANÃLISIS DE POSTULACIÃ“N ===\n\nSCORE FINAL: ${analisis.scoreFinal}/100\nâ€¢ Compatibilidad: ${analisis.scoreCompatibilidad}/100\nâ€¢ Veracidad: ${analisis.scoreVeracidad}/100\n\nRECOMENDACIÃ“N: ${analisis.recomendacion}\n\n--- FORTALEZAS ---\n${analisis.fortalezas.map((f, i) => `${i+1}. ${f}`).join('\\n')}\n\n--- DEBILIDADES ---\n${analisis.debilidades.map((d, i) => `${i+1}. ${d}`).join('\\n')}\n\n${analisis.discrepancias.length > 0 ? `--- DISCREPANCIAS DETECTADAS ---\\n${analisis.discrepancias.map((d, i) => `${i+1}. ${d}`).join('\\n')}\\n` : ''}\n--- ANÃLISIS DETALLADO ---\n${analisis.analisisDetallado}\n`;\n\nreturn {\n  json: {\n    postulacionId: postulacionId,\n    puntajeIa: analisis.scoreFinal,\n    feedbackIa: feedbackTexto,\n    analisisCompleto: analisis, // JSON completo para respuesta del webhook\n    estadoNuevo: analisis.scoreFinal >= 75 ? 'EVALUADO' : analisis.scoreFinal >= 50 ? 'EN_REVISION' : 'EVALUADO'\n  }\n};"
      },
      "id": "process-ia-result",
      "name": "âš™ï¸ Procesar Resultado IA",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2440, 460]
    },
    {
      "parameters": {
        "url": "=http://apt-backend:3000/postulaciones/{{ $json.postulacionId }}",
        "authentication": "none",
        "requestMethod": "PATCH",
        "sendBody": true,
        "contentType": "json",
        "bodyParameters": {
          "values": [
            {
              "name": "puntajeIa",
              "value": "={{ $json.puntajeIa }}"
            },
            {
              "name": "feedbackIa",
              "value": "={{ $json.feedbackIa }}"
            },
            {
              "name": "estado",
              "value": "={{ $json.estadoNuevo }}"
            }
          ]
        },
        "options": {}
      },
      "id": "update-postulacion",
      "name": "ğŸ’¾ Actualizar PostulaciÃ³n",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.1,
      "position": [2660, 460]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify({\n  success: true,\n  postulacionId: $('âš™ï¸ Procesar Resultado IA').item.json.postulacionId,\n  analisis: $('âš™ï¸ Procesar Resultado IA').item.json.analisisCompleto,\n  message: 'AnÃ¡lisis completado exitosamente'\n}, null, 2) }}",
        "options": {
          "responseCode": 200,
          "responseHeaders": {
            "entries": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          }
        }
      },
      "id": "respond-webhook",
      "name": "âœ… Responder Webhook",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [2880, 460]
    },
    {
      "parameters": {
        "jsCode": "// Log de error para debugging\nconst error = $input.item?.error || 'Error desconocido';\nconsole.error('âŒ Error en workflow:', error);\n\nreturn {\n  json: {\n    success: false,\n    error: error.message || error,\n    postulacionId: $('ğŸ¯ Trigger: Nueva PostulaciÃ³n').item?.json?.postulacionId || 'unknown',\n    timestamp: new Date().toISOString()\n  }\n};"
      },
      "id": "error-handler",
      "name": "ğŸš¨ Manejador de Errores",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [2440, 660]
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "={{ JSON.stringify($json, null, 2) }}",
        "options": {
          "responseCode": 500
        }
      },
      "id": "respond-error",
      "name": "âŒ Responder Error",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [2660, 660]
    }
  ],
  "connections": {
    "ğŸ¯ Trigger: Nueva PostulaciÃ³n": {
      "main": [
        [
          {
            "node": "ğŸ“„ Obtener PostulaciÃ³n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“„ Obtener PostulaciÃ³n": {
      "main": [
        [
          {
            "node": "ğŸ’¼ Obtener Vacante",
            "type": "main",
            "index": 0
          },
          {
            "node": "ğŸ‘¤ Obtener Candidato",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¼ Obtener Vacante": {
      "main": [
        [
          {
            "node": "ğŸ”§ Preparar Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ‘¤ Obtener Candidato": {
      "main": [
        [
          {
            "node": "ğŸ”§ Preparar Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ”§ Preparar Datos": {
      "main": [
        [
          {
            "node": "â“ Â¿Tiene CV?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â“ Â¿Tiene CV?": {
      "main": [
        [
          {
            "node": "â¬‡ï¸ Descargar CV",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "âŒ Sin CV",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "â¬‡ï¸ Descargar CV": {
      "main": [
        [
          {
            "node": "ğŸ“ Extraer Texto CV",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“ Extraer Texto CV": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge Datos CV",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âŒ Sin CV": {
      "main": [
        [
          {
            "node": "ğŸ”€ Merge Datos CV",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ğŸ”€ Merge Datos CV": {
      "main": [
        [
          {
            "node": "ğŸ“¦ Combinar Datos",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ“¦ Combinar Datos": {
      "main": [
        [
          {
            "node": "ğŸ¤– AnÃ¡lisis IA (OpenAI)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ¤– AnÃ¡lisis IA (OpenAI)": {
      "main": [
        [
          {
            "node": "âš™ï¸ Procesar Resultado IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "âš™ï¸ Procesar Resultado IA": {
      "main": [
        [
          {
            "node": "ğŸ’¾ Actualizar PostulaciÃ³n",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ğŸ’¾ Actualizar PostulaciÃ³n": {
      "main": [
        [
          {
            "node": "âœ… Responder Webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveDataErrorExecution": "all",
    "saveDataSuccessExecution": "all",
    "saveManualExecutions": true,
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": ""
  },
  "versionId": "1.0.0",
  "meta": {
    "templateCredsSetupCompleted": false,
    "instanceId": "apt-mvp-production"
  },
  "id": "apt-analisis-completo",
  "tags": [
    {
      "id": "apt",
      "name": "APT"
    },
    {
      "id": "reclutamiento",
      "name": "Reclutamiento"
    },
    {
      "id": "ia",
      "name": "Inteligencia Artificial"
    },
    {
      "id": "mvp",
      "name": "MVP"
    }
  ]
}
